import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Rencontre 9 - Utilisateurs locaux et commentaires

:::note R√©sum√© de la s√©ance

<Tabs>

<TabItem value="deroulement" label="üë®‚Äçüè´ D√©roulement du cours">

1. Gestion des utilisateurs locaux sous Windows
1. Commentaires et rubriques d'aide bas√©es sur les commentaires
1. Utilisation des fonctionnalit√©s de d√©bogage dans VS Code
1. Utilisation de Git, GitHub et GitHub Classroom
1. Pr√©sentation du TP1

</TabItem>

<TabItem value="exercices" label="üíª Exercices √† compl√©ter">

- L'exercice de remise sur GitHub Classroom (TP0)
- Les exercices que vous n'avez pas encore compl√©t√©s
- Travail sur le TP1

</TabItem>

<TabItem value="ressources" label="üìö Ressources √† consulter">

- La pr√©sentation PowerPoint est sur le Teams du cours, sous le canal G√©n√©ral > Fichiers > Supports de cours.
- Des tutoriels pour GitHub et LabInfo sont dans la biblioth√®que de contenu sur OneNote.

</TabItem>

</Tabs>

:::


## Gestion des utilisateurs locaux

√Ä l'exception des contr√¥leurs de domaine, toutes les machines Windows, qu'elles soient d'une √©dition client (Windows 10 / 11) ou serveur, poss√®dent des utilisateurs locaux. Comme vous l'avez vu dans le cours de syst√®mes d'exploitation, les utilisateurs locaux peuvent √™tre g√©r√©s au moyen du composant enfichable "Utilisateurs et groupes locaux" dans une console MMC (accessible par lusrmgr.msc ou compmgmt.msc). Par d√©faut, lorsqu'on installe Windows, un certain nombre de comptes utilisateurs sont cr√©√©s, dont *Administrateur* et *Invit√©*.



Windows poss√®de √©galement un ensemble de groupes locaux pr√©d√©finis. On peut ajouter des comptes (locaux ou domaine) dans un groupe local. Certains groupes poss√®dent des privil√®ges particuliers, comme le groupe **Administrateurs**; tous les comptes utilisateurs membres de ce groupe disposent du **privil√®ge d'√©l√©vation** ("ex√©cuter en tant qu'admin"). Les membres du groupe **Utilisateurs**, quant √† eux, disposent du privil√®ge de **d√©marrage de session locale**. 

:::caution
Un utilisateur qui n'est pas membre d'un de ces groupes ne sera pas autoris√© √† d√©marrer une session.
:::

On peut utiliser PowerShell pour contr√¥ler les utilisateurs locaux, les groupes locaux ainsi que l'appartenance aux groupes locaux. PowerShell offre pour ce faire un module `Microsoft.PowerShell.LocalAccounts` qui renferme plusieurs commandes, notamment:

- `Add-LocalGroupMember`
- `Disable-LocalUser`
- `Enable-LocalUser`
- `Get-LocalGroup`
- `Get-LocalGroupMember`
- `Get-LocalUser`
- `New-LocalGroup`
- `New-LocalUser`
- `Remove-LocalGroup`
- `Remove-LocalGroupMember`
- `Remove-LocalUser`
- `Rename-LocalGroup`
- `Rename-LocalUser`
- `Set-LocalGroup`
- `Set-LocalUser`


### Consulter les utilisateurs existants

La commande Get-LocalUser permet d'obtenir la liste des utilisateurs locaux. Elle retourne un ou plusieurs objets de types `[Microsoft.PowerShell.Commands.LocalUser]` qui d√©crivent un compte utilisateur local.

<PowerShellWindow workdir="C:\" command="Get-LocalUser" result="
Name               Enabled Description 
----               ------- -----------
Administrateur     True    Compte d‚Äôutilisateur d‚Äôadministration
DefaultAccount     False   Compte utilisateur g√©r√© par le syst√®me.
Invit√©             False   Compte d‚Äôutilisateur invit√©
paul               True    Boss de la compagnie
WDAGUtilityAccount False   Compte d‚Äôutilisateur g√©r√© et utilis√© par le syst..."/>

Ces objets poss√®dent plusieurs informations sur le compte utilisateur. On peut les voir en explorant la structure de l'objet, par exemple avec `Select-Object *`.

<PowerShellWindow workdir="C:\" command="Get-LocalUser -Name 'paul' | Select-Object *" result="
AccountExpires         : 2023-05-12 20:06:27
Description            : Boss de la compagnie
Enabled                : True
FullName               : Paul Meilleur
PasswordChangeableDate : 2023-04-13 20:06:27
PasswordExpires        : 2023-05-24 20:06:27
UserMayChangePassword  : True
PasswordRequired       : False
PasswordLastSet        : 2023-04-12 20:06:27
LastLogon              :
Name                   : paul
SID                    : S-1-5-21-3297567932-2200011671-69726474-1001
PrincipalSource        : Local
ObjectClass            : Utilisateur"/>


### Cr√©ation d'un nouvel utilisateur

La commande `New-LocalUser` cr√©e un utilisateur local et retourne l'objet d√©crivant cet utilisateur dans le pipeline (comme il est d'usage par la majorit√© des commandes exploitant le verbe `New-`). Il faut √©videmment que la session PowerShell soit √©lev√©e en tant qu'admin pour apporter des modifications sur les utilisateurs locaux.

La commande offre un certains nombres de param√®tres pour sp√©cifier les diff√©rentes propri√©t√©s du compte √† cr√©er.

| Param√®tre | Type | Description |
| -- | -- | -- |
| `Name` | String | Le nom d'utilisateur (*login*) |
| `FullName` | String | Le nom complet (pr√©nom nom) |
| `Description` | String | Le champ Description |
| `AccountExpires` | DateTime | La date d'expiration de l'utilisateur |
| `AccountNeverExpires` | Switch | Indique que le compte n'expire jamais |
| `Disabled` | Switch | Indique que le compte est d√©sactiv√© d√®s sa cr√©ation |
| `Password` | SecureString | Le mot de passe de l'utilisateur |
| `NoPassword` | Switch | Indique que le compte n'a aucun mot de passe (pas tr√®s s√©curitaire!) |
| `PasswordNeverExpires` | Switch | Indique que le mot de passe n'expire jamais |
| `UserMayNotChangePassword` | Switch | Indique que l'utilisateur n'a pas le droit de modifier son mot de passe |
| `WhatIf` | Switch | Fait en sorte que la commande ne cr√©e pas l'utilisateur pour vrai (utile pour tester) |

:::Info
Le mot de passe est de type `[SecureString]` et pas une cha√Æne de caract√®res normale. Ce qui fait qu'on doit d'abord convertir la cha√Æne de caract√®re en cha√Æne s√©curis√©e. On peut le faire au moyen de la commande `ConvertTo-SecureString`.

```powershell
$securepasswd = 'Passw0rd' | ConvertTo-SecureString -AsPlainText -Force
```
:::

Voici un exemple de cr√©ation d'un compte utilisateur local (en utilisant le *splatting*):

```powershell
$NouvelUtilisateurSplat = @{
    Name = "paul"
    FullName = "Paul Meilleur"
    Description = "Boss de la compagnie"
    AccountExpires = (Get-Date).AddDays(30)   # Dans 30 jours
    Password = ConvertTo-SecureString -String "Passw0rd" -AsPlainText -Force
}

New-LocalUser @NouvelUtilisateurSplat -whatif
```

:::danger
On ne devrait jamais mettre des mots de passe en clair dans un script, ni stocker un mot de passe dans une variable en texte clair!!! Voici quelques options pour l'√©viter:

- Cr√©er un algorithme qui choisit automatiquement un mot de passe en fonction d'information provenant de l'ext√©rieur
- Utiliser la commande `Read-Host -AsSecureString` pour demander √† l'utilisateur d'entrer un mot de passe (dont la saisie est masqu√©e
- Utiliser `Get-Credential` pour fournir un nom d'utilisateur et un mot de passe. Nous verrons plus loin cette commande lorsque nous traiterons de l'authentification par PowerShell.
:::

### Groupes locaux

√Ä l'instar des utilisateurs, on peut conna√Ætre les groupes locaux au moyen de la commande `Get-LocalGroup`.

Pour cr√©er un groupe local, on utilise la commande `New-LocalGroup`. L√† encore, cette commande ne fonctionne que dans une session PowerShell √©lev√©e.

Pour obtenir les membres d'un groupe, on peut utiliser la commande `Get-LocalGroupMember`.

<PowerShellWindow workdir="C:\" command="Get-LocalGroupMember -Group 'Administrateurs'" result="
ObjectClass Name                    PrincipalSource
----------- ----                    ---------------
Utilisateur PC0001\Administrateur   Local
Utilisateur PC0001\bob              Local
Utilisateur PC0001\paul             Local
Utilisateur PC0001\pierre           Local
Groupe      MINOU\Admins du domaine ActiveDirectory
Utilisateur MINOU\paul.meilleur     ActiveDirectory"/>

Pour ajouter un utilisateur dans un groupe, on utilise la commande `Add-LocalGroupMember`. Cette commande prend en param√®tre `-Member` qui d√©signe le membre √† ajouter, ainsi que `-Group` qui d√©signe le groupe dans lequel l'ajouter.

Add-LocalGroupMember ‚ÄìMember "Paul" -Group "Administrateurs"

Cette commande admet qu'on passe le membre √† ajouter par le pipeline en entr√©e.

Get-LocalUser -Name "Paul" | Add-LocalGroupMember -Group "Administrateurs"

Cela permet, entre autres, de cr√©er un compte et l'ajouter imm√©diatement √† un groupe, puisque la cr√©ation g√©n√®re un objet repr√©sentant l'utilisateur.

New-LocalUser -Name "Zoe" -NoPassword | Add-LocalGroupMember -Group "Utilisateurs"

:::info
On peut aussi ajouter des utilisateurs ou des groupes du domaine comme membre d'un groupe local. Pour ce faire, on n'a qu'√† sp√©cifier le sAMAccountName du principal de s√©curit√© du domaine. Si la machine dispose d'une relation d'approbation avec le domaine du compte, celui-ci sera ajout√© comme membre au groupe.

Add-LocalGroupMember ‚ÄìMember "DOMAINE\paul.meilleur" -Group "Administrateurs"
:::


:::tip
Le nom des groupes est diff√©rent sur les versions anglaise et fran√ßaise de Windows. Pour que le script fonctionne ind√©pendamment de la langue du syst√®me, on peut utiliser le SID du groupe plut√¥t que son nom. Le SID est un num√©ro d'identification unique, et dans le cas des groupes pr√©d√©finis dans Windows (Administrateurs, Utilisateurs), il est toujours le m√™me peu importe la langue.

On peut voir les SID des groupes avec la commande suivante:

```powershell
Get-LocalGroup | Select-Object -Property Name, SID
```

Voici quelques SID bien connus:

| Nom fran√ßais | Nom anglais | SID |
| -- | -- | -- |
| Administrateurs | Administrators | `S-1-5-32-544` |
| Utilisateurs | Users | `S-1-5-32 545` |

Par exemple, pour ajouter un utilisateur au groupe des administrateurs:

```powershell
$MonUtilisateur | Add-LocalGroupMember -SID "S-1-5-32-544"
```
:::


## Commentaires

Au d√©but de la session, nous avons vu les diff√©rents types de commentaires en PowerShell. Les commentaires sont des parties du texte compris dans le fichier script qui sont ignor√©s par l'interpr√©teur. Ils servent principalement √† documenter le code.

### Commentaires de ligne

Les commentaires de ligne sont identifi√©s par le caract√®re `#`. D√®s que ce caract√®re est rencontr√© sur une ligne de texte, le reste de la ligne n'est pas interpr√©t√©. On peut l'utiliser au d√©but de la ligne, ou apr√®s une commande.

```powershell
# Ceci est un exemple de commentaire de ligne
Get-ChildItem -Path $env:Windir    # Voici un autre commentaire
```

### Blocs de commentaires

Les blocs de commentaires sont utiles lorsque plusieurs lignes cons√©cutives doivent √™tre mises en commentaire. On peut toujours faire d√©buter plusieurs lignes par le caract√®re `#`, mais on peut aussi mettre plusieurs lignes entre `<# et #>`.

```powershell
# Voici plusieurs
# lignes En
# commentaires

<#
Ou encore on peut
√©crire un bloc de
commentaires comme √ßa.
#>
```

### Aide bas√©e sur les commentaires

Nous avons vu qu'il est possible d'obtenir de l'aide sur une commande gr√¢ce √† la commande Get-Help. On peut sp√©cifier, gr√¢ce √† des commentaires le contenu de la rubrique d'aide d'un script ou une fonction.

Pour ce faire, il suffit de cr√©er un bloc de commentaires, entre `<#` et `#>` au d√©but ou √† la fin du script ou de la fonction, et de sp√©cifier le contenu des diff√©rentes rubriques dans des sections correspondantes. Voici les principales:

| Section | Description |
| -- | -- |
| .SYNOPSIS | R√©sum√© de la fonctionnalit√© du script ou de la fonction. |
| .DESCRIPTION | Description plus d√©taill√©e du script ou de la fonction. |
| .PARAMETER *NomDuParam√®tre* | Fournit une description √† un param√®tre. Il doit y en avoir un pour chaque param√®tre. |
| .INPUTS | D√©crit le type et la nature des donn√©es trait√©es en entr√©e par pipeline. |
| .OUTPUTS | D√©crit le type et la nature des donn√©es sortie sur le pipeline. |
| .EXAMPLE | Donne un exemple d'utilisation ainsi que son r√©sultat. On peut fournir plusieurs exemples. |
| .NOTES | On peut fournir des notes suppl√©mentaires |
| .LINK | On peut fournir un lien URL, par exemple vers une page de documentation |

Il existe aussi [d'autres sections](https://learn.microsoft.com/fr-ca/powershell/module/microsoft.powershell.core/about/about_comment_based_help?view=powershell-5.1) que l'on peut ajouter √† un bloc de commentaires.

Voici un exemple d'un script `RepeteChaine.ps1` qui impl√©mente une rubrique d'aide bas√©e sur les commentaires:

```powershell
[CmdletBinding()]
Param(
    [Parameter(Mandatory,ValueFromPipeline)]
    [string] $Chaine,

    [Parameter(Mandatory)]
    [int] $R√©p√©titions
)

$Chaine * $R√©p√©titions

<#
.SYNOPSIS
R√©p√®te une cha√Æne de texte un certain nombre de fois.
.DESCRIPTION
Cette fonction retourne une cha√Æne de caract√®res correspondant √† la r√©p√©tition de la cha√Æne d'entr√©e un certain nombre de fois.
.PARAMETER Chaine
Sp√©cifie la cha√Æne de caract√®res √† r√©p√©ter.
.PARAMETER R√©p√©titions
Sp√©cifie le nombre de r√©p√©titions.
.INPUTS
System.String. Ce script adbet la cha√Æne de caract√®res √† r√©p√©ter par le pipeline.
.OUTPUTS
System.String. Ce script retourne une cha√Æne r√©sultant de la r√©p√©tition de la cha√Æne d'entr√©e
.EXAMPLE
PS> .\RepeteChaine.ps1 -Chaine "abc" -R√©p√©titions 3
abcabcabc
.EXAMPLE
PS> "abc" | .\RepeteChaine.ps1 -R√©p√©titions 3
abcabcabc
.NOTES
Ce script est un exemple d'utilisation de l'aide bas√©e sur les commentaires
.LINK
https://learn.microsoft.com/fr-ca/powershell/module/microsoft.powershell.core/about/about_comment_based_help?view=powershell-5.1
#>
```

:::tip
Il est possible de sp√©cifier le texte d'aide sp√©cifiques aux param√®tres directement dans la d√©claration de ces derniers. On n'a alors plus besoin de les d√©finir dans le bloc de commentaires. Si les descriptions des param√®tres sont courtes, √ßa peut √™tre pratique.

```powershell
Param(
    #Sp√©cifie la cha√Æne de caract√®res √† r√©p√©ter.
    [Parameter(Mandatory,ValueFromPipeline)]
    [string] $Chaine,

    #Sp√©cifie le nombre de r√©p√©titions.
    [Parameter(Mandatory)]
    [int] $R√©p√©titions
)
```
:::


## Git, GitHub et GitHub Classroom

Vous avez peut-√™tre entendu parler de Git. Il s'agit d'une solution de gestion du code source. Dans les √©quipes de d√©veloppement logiciel, Git est tr√®s souvent utilis√© pour g√©rer les fichiers composant la solution.

### Git

Le logiciel Git a √©t√© cr√©√© par Linus Torvalds, le cr√©ateur de Linux. Il permet de g√©rer et contr√¥ler l'√©volution d'une solution logicielle. On peut le t√©l√©charger gratuitement sur le site https://git-scm.com/.

Lorsqu'on travaille avec Git, on doit d√©finir un **d√©p√¥t** (aussi appel√© *repository*, ou *repo*) qui contient le ou les fichiers qui composent la solution. Chaque fois qu'on fait une modification significative du code (par exemple, on impl√©mente une nouvelle fonctionnalit√©), on proc√®de √† un *commit* et lui donnant une description.

Il existe plusieurs services sur le *cloud* permettant de conserver un d√©p√¥t. Le plus connu est GitHub, mais il y a aussi GitLabs, BitBucket, et d'autres. Dans ce cours, nous utiliserons GitHub.


### GitHub

[GitHub](https://github.com) est un service qui appartient √† Microsoft et sert √† h√©berger des d√©p√¥ts publics ou priv√©s. Un d√©p√¥t public h√©berge des solutions *open source*. N'importe qui peut y avoir acc√®s. Pour les projets dont le code source ne doit pas √™tre divulgu√© au public, on peut cr√©er un d√©p√¥t priv√©. Sur GitHub, on doit disposer d'un compte professionnel pour avoir le droit de cr√©er un d√©p√¥t priv√©. Un compte professionnel co√ªte normalement 4$ US par mois, mais votre statut d'√©tudiant vous permet de profiter des avantages pro gratuitement pour la dur√©e de vos √©tudes.

Vous pouvez vous cr√©er un compte √† l'adresse https://github.com/login. Suivez les √©tapes pour obtenir votre pack d'√©tudiant, ce qui vous donnera droit √† des avantages gratuits. Vous aurez √† fournir une preuve de votre statut d'√©tudiant.


### GitHub Classroom

GitHub Classroom est une solution affili√©e √† GitHub qui facilite l'utilisation de GitHub dans un cadre √©ducatif. Les travaux pratiques que vous r√©aliserez dans ce cours devront √™tre remis par GitHub Classroom.

Lorsqu'un nouveau travail vous sera soumis, votre prof vous communiquera un lien vers GitHub Classroom avec un code. En cliquant sur ce lien, vous devrez vous authentifier avec votre compte GitHub.

Si c'est le premier travail du cours, le site vous demandera de lier votre compte √† votre nom. Vous n'aurez √† faire ceci qu'une seule fois par cours.

Ensuite, acceptez le travail. Cela cr√©era pour vous une copie du d√©p√¥t mod√®le qui comprend tous les fichiers relatifs au travail √† r√©aliser. Seuls vous et votre professeur aurez acc√®s √† votre d√©p√¥t.

Ce d√©p√¥t vous √©tant r√©serv√©, vous pourrez synchroniser vos fichiers et proc√©der √† la remise de vos travaux. Votre professeur pourra vous donner des commentaires et de la r√©troaction.



