import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Rencontre 3 - Collections et types

:::note R√©sum√© de la s√©ance

<Tabs>

<TabItem value="deroulement" label="üë®‚Äçüè´ D√©roulement du cours">

1. Rappel du cours pr√©c√©dent
1. Hashtable
1. PSCustomObject
1. Splatting
1. Devoir #1 (en √©quipe)

</TabItem>

<TabItem value="exercices" label="üíª Exercices √† compl√©ter">

- Devoir #1

</TabItem>

<TabItem value="ressources" label="üìö Ressources √† consulter">

La pr√©sentation PowerPoint est sur le Teams du cours, sous le canal G√©n√©ral > Fichiers > Supports de cours.

</TabItem>

</Tabs>

:::

# Rencontre 4 - Dictionnaires

Un **dictionnaire**, aussi appel√© *tableau associatif*, est une structure de donn√©es qui se caract√©rise par une liste de correspondance entre une cl√© et une valeur, qui repr√©sentent des propri√©t√©s. La cl√© repr√©sente le nom de la propri√©t√©, et la valeur, son contenu. Contrairement aux tableaux, l'ordre des √©l√©ments n'a pas d'importance, justement parce qu'on peut y acc√©der librement en utilisant la cl√©.

Dans PowerShell, on travaille avec deux types de dictionnaires, des *HashTable*, et des *PSCustomObject*.


## Tables de hachage (*HashTable*)

La table de hachage (*HashTable*) est la forme la plus rudimentaire d'un dictionnaire en PowerShell.

Voici un exemple de cr√©ation d'un objet de type *HashTable*:

<Tabs>
<TabItem value="code" label="Code">

```powershell
$minou = @{ 
    Nom = "Garfield"
    Espece = "Felis catus"
    Passion = "Manger"
}
```
</TabItem>
<TabItem value="resultat" label="R√©sultat">

<PowerShellWindow workdir="C:\" command="$minou" result="
Name            Value
----            -----
Passion         Manger
Nom             Garfield
Espece          Felis catus"/>

</TabItem>
</Tabs>

Chaque cl√© de cet objet est le nom d'une de ses propri√©t√©s. On peut donc acc√©der √† une propri√©t√© avec la notation ".".

<PowerShellWindow workdir="C:\" command="$minou.Passion" result="
Manger
"/>

:::tip
Pour cr√©er un objet *hashtable* en une seule ligne, utilisez le caract√®re ; entre les √©l√©ments.

```powershell
$minou = @{ Nom = "Garfield" ; Espece = "Felis catus" ; Passion = "Manger" }
```
:::

### Dictionnaires tri√©s

G√©n√©ralement, on n'a pas besoin qu'un dictionnaire soit tri√©, car il sert √† acc√©der √† ses propri√©t√©s √† la demande, et non de mani√®re s√©quentielle. Mais si, pour une quelconque raison, vous souhaitiez tout de m√™me pr√©server l'ordre des √©l√©ments du dictionnaire, pour pouvez d√©clarer l'attribut `[ordered]`.

<Tabs>
<TabItem value="code" label="Code">

```powershell
$minou = [ordered]@{ 
    Nom = "Garfield"
    Espece = "Felis catus"
    Passion = "Manger"
}
```
</TabItem>
<TabItem value="resultat" label="R√©sultat">

<PowerShellWindow workdir="C:\" command="$minou" result="
Name            Value
----            -----
Nom             Garfield
Espece          Felis catus
Passion         Manger"/>

</TabItem>
</Tabs>

### Comportement du *HashTable*

Un *HashTable* n'a pas vraiment le m√™me comportement qu'un objet PowerShell. Ce type d'objet est en fait une structure de donn√©es compos√©e de cl√©s et de valeurs, comme un dictionnaire.

L'exemple suivant montre un tableau de *HashTable*, le r√©sultat que nous nous attendrions d'avoir lors de l'affichage et le r√©sultat r√©el.

<Tabs>
<TabItem value="code" label="Code">

```powershell
$minous = @(
    @{
        Nom = "Garfield"
        Espece = "Felis catus"
        Passion = "Manger"
    },
    @{
        Nom = "Grumpy Cat"
        Espece = "Felis catus"
        Passion = "Faire la baboune"
    }
)
```

</TabItem>
<TabItem value="resultat_souhaite" label="R√©sultat souhait√©">

<PowerShellWindow workdir="C:\" command="$minou" result="
Nom           Espece         Passion
---           ------         -------
Garfield      Felis catus    Manger
Grumpy Cat    Felis catus    Faire la baboune" />

</TabItem>
<TabItem value="resultat" label="R√©sultat r√©el">

<PowerShellWindow workdir="C:\" command="$minou" result="
Name            Value
----            -----
Passion         Manger
Nom             Garfield
Espece          Felis catus
Passion         Faire la baboune
Nom             Grumpy Cat
Espece          Felis catus" />

</TabItem>
</Tabs>


## Objets personnalis√©s (*PSCustomObject*)

Pour cr√©er un objet disposant de propri√©t√©s propres mais se comportant de la m√™me mani√®re que les objets PowerShell, on utilise g√©n√©ralement le type *PSCustomObject*. Ce type repr√©sente litt√©ralement un objet PowerShell personnalit√©, duquel nous d√©finissons nous-m√™me les propri√©t√©s. Ce type d'objet est con√ßu pour imiter un objet standard compos√© de propri√©t√©s et de m√©thodes, contrairement au *HashTable* qui n'est qu'un dictionnaire servant √† associer des cl√©s √† des valeurs. C'est d'ailleurs ce type d'objet que produit la commande `Select-Object -Property`.

On cr√©e un objet PSCustomObject de la m√™me mani√®re qu'un *HashTable*, √† une diff√©rence pr√®s: on doit sp√©cifier qu'il s'agit du type PSCustomObject.

<Tabs>
<TabItem value="code" label="Code">

```powershell
$minou = [PSCustomObject]@{ 
    Nom = "Garfield"
    Espece = "Felis catus"
    Passion = "Manger"
}
```

</TabItem>
<TabItem value="resultat" label="R√©sultat">

<PowerShellWindow workdir="C:\" command="$minou" result="
Nom           Espece         Passion
---           ------         -------
Garfield      Felis catus    Manger" />

</TabItem>
</Tabs>


### Collections de *PSCustomObject*

Contrairement aux *HashTable*, les *PSCustomObject* sont structur√©s pour faciliter leur manipulation en collection.

<Tabs>
<TabItem value="code" label="Code">

```powershell
$minous = @(
    [PSCustomObject]@{
        Nom = "Garfield"
        Espece = "Felis catus"
        Passion = "Manger"
    },
    [PSCustomObject]@{
        Nom = "Grumpy Cat"
        Espece = "Felis catus"
        Passion = "Faire la baboune"
    }
)
```

</TabItem>
<TabItem value="resultat" label="R√©sultat">

<PowerShellWindow workdir="C:\" command="$minous" result="
Nom           Espece         Passion
---           ------         -------
Garfield      Felis catus    Manger
Grumpy Cat    Felis catus    Faire la baboune" />

</TabItem>
</Tabs>


### Modifier une propri√©t√©

Pour modifier une propri√©t√© d'un objet *PSCustomObject*, on n'a qu'√† lui affecter une nouvelle valeur.

```powershell
$minou.Passion = "Manger de la lasagne"
```

Il faut toutefois que la propri√©t√© existe dans l'objet.


### Ajouter des propri√©t√©s

Nous avons vu plus haut comment cr√©er un objet *PSCustomObject* lorsqu'on conna√Æt toutes les propri√©t√©s de l'objet, et comment affecter une nouvelle valeur √† une propri√©t√© existante. Pour cr√©er une nouvelle propri√©t√© dans l'objet, on peut utiliser la commande `Add-Member` et lui passer en entr√©e l'objet √† modifier par le *pipeline*.

Pour une propri√©t√© simple, on n'a qu'√† cr√©er un nouveau membre de type "NoteProperty" et lui affecter un nom et une valeur.

```powershell
$minou | Add-Member -MemberType NoteProperty -Name "Couleur" -Value "Roux"
```

### Ajouter des m√©thodes

On peut aussi ajouter d'autres types de membres, dont des m√©thodes. Contrairement aux propri√©t√©s qui retournent un objet stock√© statiquement, les m√©thodes permettent d'ex√©cuter du code. 

Le proc√©d√© est semblable √† l'ajout de propri√©t√©s, √† l'exception qu'on d√©finit un membre de type ScriptMethod et qu'on lui sp√©cifie un ScriptBlock.

```powershell
$minou | Add-Member -MemberType ScriptMethod -Name "Miauler" -Value { Write-Host "Miaou" }
```


## Splatting

Le *splatting* est une technique qui consiste √† identifier les arguments √† passer dans une commande √† l'int√©rieur d'un objet.

Il suffit de d√©finir un HashTable compos√© des arguments, dont la cl√© repr√©sente le nom de l'argument et la valeur, la valeur de l'argument. Dans le cas des arguments de type *switch*, on leur affecte la valeur `$true`. Puis, il suffit se passer cette variable √† la commande, en utilisant la forme `@Nomdelavariable`.

<Tabs>
<TabItem value="avec" label="Avec splatting">

```powershell
$splat = @{
    FilePath = "C:\Windows\Notepad.exe"
    ArgumentList = "C:\minou\allo.txt"
    WorkingDirectory = "C:\"
    PassThru = $true
    WindowStyle = "Maximized"
    Wait = $true
    Verb = "Runas"
}

Start-Process @splat
```

</TabItem>
<TabItem value="sans" label="Sans splatting">

```powershell
Start-Process -FilePath "C:\Windows\Notepad.exe" -ArgumentList "C:\minou\allo.txt" -WorkingDirectory "C:\" -PassThru -WindowStyle "Maximized" -Wait -Verb "Runas"
```

</TabItem>
</Tabs>
